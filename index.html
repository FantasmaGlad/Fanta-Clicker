<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Baa-Clicker</title>
    <link rel="stylesheet" href="../assets/styles/global.css">
    <style>
        body {
            background: linear-gradient(135deg, #4a00e0, #8e2de2);
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
        }

        .main-container {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin: 20px;
        }

        .game-container {
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            width: 70%;
        }

        .upgrades-container {
            background-color: rgba(0, 0, 0, 0.7);
            padding: 20px;
            border-radius: 15px;
            color: white;
            width: 25%;
        }

        .title {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .sub-title {
            font-size: 1.5rem;
            margin-top: -10px;
            color: #555;
        }

        #clickButton {
            border: none;
            background-color: #4CAF50;
            border-radius: 50%;
            width: 150px;
            height: 150px;
            cursor: pointer;
            margin: 20px auto;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #clickButton img {
            width: 90%;
            height: 90%;
            border-radius: 50%;
        }

        #score {
            margin-top: 10px;
            font-size: 24px;
            color: #333;
        }

        #productionPerSecond {
            margin-top: 5px;
            font-size: 20px;
            color: #666;
        }

        .upgrade-item {
            margin: 10px 0;
            padding: 10px;
            border-radius: 10px;
            background-color: white;
            color: black;
            cursor: pointer;
        }

        .upgrade-item:hover {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- Conteneur principal du jeu -->
        <div class="game-container">
            <h1 class="title">Baa-Clicker</h1>
            <h2 class="sub-title">Usine à Baamix de "<span id="playerPseudo"></span>"</h2>
            <div>
                <button id="clickButton">
                    <img src="../assets/images/Baatman.png" alt="Baamix">
                </button>
            </div>
            <p id="score">Score : 0</p>
            <p id="productionPerSecond">Production par seconde : 0</p>
        </div>

        <!-- Conteneur des améliorations -->
        <div class="upgrades-container">
            <h2>Améliorations</h2>
            <div id="upgradeList">
                <!-- Les améliorations seront ajoutées dynamiquement -->
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js";
        import { getDatabase, ref, update } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAt4S0P5Jr1roapnPmDVw_MPqQfWtkb_dIk",
            authDomain: "baamix-clicker.firebaseapp.com",
            projectId: "baamix-clicker",
            storageBucket: "baamix-clicker.appspot.com",
            messagingSenderId: "559143757551",
            appId: "1:559143757551:web:c018039d3b34465132edd1a",
            measurementId: "G-X7J216NSD9",
            databaseURL: "https://baamix-clicker-default-rtdb.europe-west1.firebasedatabase.app/"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        const pseudo = localStorage.getItem("playerPseudo");
        if (!pseudo) {
            window.location.href = "welcome.html";
        } else {
            document.getElementById('playerPseudo').innerText = pseudo;
        }

        const clickButton = document.getElementById("clickButton");
        const scoreDisplay = document.getElementById("score");
        const productionPerSecondDisplay = document.getElementById("productionPerSecond");

        let score = 0;
        let productionPerSecond = 0;
        let fermeCount = 0, usineCount = 0, superMachineCount = 0;

        const upgrades = [
            { name: "Ferme à Baamix", cost: 50, production: 1, count: 0 },
            { name: "Usine à Baamix", cost: 200, production: 5, count: 0 },
            { name: "Super Machine", cost: 500, production: 10, count: 0 },
        ];

        function updateScoreDisplay() {
            scoreDisplay.innerText = `Score : ${score}`;
        }

        function updateProductionDisplay() {
            productionPerSecondDisplay.innerText = `Production par seconde : ${productionPerSecond}`;
        }

        function addUpgradeItems() {
            const upgradeList = document.getElementById("upgradeList");
            upgrades.forEach((upgrade, index) => {
                const upgradeItem = document.createElement("div");
                upgradeItem.className = "upgrade-item";
                upgradeItem.innerText = `${upgrade.name} - Coût : ${upgrade.cost} points`;
                upgradeItem.addEventListener("click", () => buyUpgrade(index));
                upgradeList.appendChild(upgradeItem);
            });
        }

        function buyUpgrade(index) {
            const upgrade = upgrades[index];
            if (score >= upgrade.cost) {
                score -= upgrade.cost;
                upgrade.count++;
                productionPerSecond += upgrade.production;
                upgrade.cost = Math.floor(upgrade.cost * 1.1); // Incrément de 10%
                updateScoreDisplay();
                updateProductionDisplay();
                const playerRef = ref(database, `players/${pseudo}`);
                update(playerRef, { score, [`${upgrade.name.toLowerCase()}Count`]: upgrade.count });
            }
        }

        clickButton.addEventListener("click", () => {
            score++;
            updateScoreDisplay();
        });

        function startAutoProduction() {
            setInterval(() => {
                score += productionPerSecond;
                updateScoreDisplay();
            }, 1000);
        }

        window.onload = function () {
            addUpgradeItems();
            startAutoProduction();
        };
    </script>
</body>
</html>